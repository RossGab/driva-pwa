<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Driver UI Configuration</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background:#f3f3f3;
  padding:12px;
}

h2 {
  text-align:center;
}

.card {
  background:#fff;
  padding:12px;
  border-radius:8px;
  box-shadow:0 0 4px rgba(0,0,0,.1);
  margin-bottom:12px;
}

input, select, button {
  width:100%;
  padding:8px;
  margin-top:6px;
  border-radius:6px;
  border:1px solid #ccc;
}

button {
  background:#007bff;
  color:#fff;
  border:none;
  cursor:pointer;
}

button.secondary {
  background:#555;
}

.field-item {
  background:#f9f9f9;
  padding:8px;
  border-radius:6px;
  margin-top:6px;
  font-size:13px;
}

.field-item span {
  display:block;
}
</style>
</head>

<body>

<h2>âš™ Driver UI Configuration</h2>

<div class="card">
  <b>Job Type</b>
  <input id="jobTypeInput" placeholder="e.g. RTP">

  <b>Delivery Method</b>
  <input id="deliveryMethodInput" placeholder="e.g. N1-Received">
</div>

<div class="card">
  <b>Add Description / Field</b>

  <input id="fieldLabel" placeholder="Label (e.g. Received by)">
  
  <select id="fieldType">
    <option value="text">Text</option>
    <option value="textarea">Textarea</option>
  </select>

  <label style="font-size:13px;">
    <input type="checkbox" id="fieldRequired"> Required
  </label>

  <button onclick="addField()">âž• Add Description</button>
</div>

<div class="card">
  <b>Current Descriptions</b>
  <div id="fieldList">No fields added</div>
</div>

<div class="card">
  <button onclick="saveConfig()">ðŸ’¾ Save / Update Delivery Method</button>
</div>

<script type="module">
import { initializeApp } from
  "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getDatabase, ref, update
} from
  "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* ===== FIREBASE ===== */
const firebaseConfig = {
  apiKey: "AIzaSyDFW61pnwLvh6HGKWt10zLYNr860fI8vkg",
  authDomain: "driva-pwa.firebaseapp.com",
  databaseURL: "https://driva-pwa-default-rtdb.firebaseio.com",
  projectId: "driva-pwa",
  storageBucket: "driva-pwa.firebasestorage.app",
  messagingSenderId: "299138219722",
  appId: "1:299138219722:web:623ff6b0a067ea822dfe33"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ===== LOCAL STATE ===== */
let FIELDS = {};

/* ===== HELPERS ===== */
function slugify(str) {
  return str.toLowerCase().replace(/[^a-z0-9]/g, "_");
}

function renderFields() {
  const box = document.getElementById("fieldList");
  box.innerHTML = "";

  if (!Object.keys(FIELDS).length) {
    box.innerHTML = "No fields added";
    return;
  }

  Object.entries(FIELDS).forEach(([key, f]) => {
    const div = document.createElement("div");
    div.className = "field-item";
    div.innerHTML = `
      <span><b>${f.label}</b></span>
      <span>Key: ${key}</span>
      <span>Type: ${f.type}</span>
      <span>Required: ${f.required ? "Yes" : "No"}</span>
    `;
    box.appendChild(div);
  });
}

/* ===== ADD FIELD ===== */
window.addField = function () {
  const label = document.getElementById("fieldLabel").value.trim();
  const type = document.getElementById("fieldType").value;
  const required = document.getElementById("fieldRequired").checked;

  if (!label) {
    alert("Label is required");
    return;
  }

  const key = slugify(label);

  FIELDS[key] = { label, type, required };

  document.getElementById("fieldLabel").value = "";
  document.getElementById("fieldRequired").checked = false;

  renderFields();
};

/* ===== SAVE CONFIG ===== */
window.saveConfig = async function () {
  const jobType = document.getElementById("jobTypeInput").value.trim();
  const deliveryMethod = document.getElementById("deliveryMethodInput").value.trim();

  if (!jobType || !deliveryMethod) {
    alert("Job Type and Delivery Method are required");
    return;
  }

  if (!Object.keys(FIELDS).length) {
    alert("Add at least one description");
    return;
  }

  const path =
    `config/driverUI/jobTypes/${jobType}/deliveryMethods/${deliveryMethod}`;

  await update(ref(db, path), {
    fields: FIELDS,
    updatedAt: new Date().toISOString()
  });

  alert("âœ… Configuration saved");

  // Reset for next delivery method
  FIELDS = {};
  renderFields();
  document.getElementById("deliveryMethodInput").value = "";
};
</script>

</body>
</html>
