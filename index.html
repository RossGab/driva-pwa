<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Driver PWA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body { font-family: Arial; padding: 10px; }
    .version { font-size: 12px; color: #666; margin-bottom: 10px; }
    .task {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 12px;
      border-radius: 6px;
    }
    .status { font-weight: bold; }
    textarea { width: 100%; min-height: 50px; }
    button { width: 100%; padding: 10px; margin-top: 8px; }
  </style>
</head>

<body>

<div class="version">Driver PWA â€” <b>v1.0.8 (NO DB)</b></div>
<h2>ğŸ“‹ Driver Task List</h2>

<div id="tasks"></div>

<script>
// ================= STORAGE =================
const STORAGE_KEY = "driver_tasks_v1";

// ================= LOAD =================
function loadTasks() {
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) {
    return JSON.parse(saved);
  }

  // Seed tasks
  const tasks = [
    {
      id: "1",
      name: "Juan Dela Cruz",
      address: "123 Rizal St",
      status: "PENDING",
      remarks: "",
      capturedAt: null,
      uploadedAt: null
    },
    {
      id: "2",
      name: "Maria Santos",
      address: "45 Del Pilar Ave",
      status: "PENDING",
      remarks: "",
      capturedAt: null,
      uploadedAt: null
    }
  ];

  localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
  return tasks;
}

// ================= SAVE =================
function saveTasks() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
}

// ================= UI =================
function format(ts) {
  return ts ? new Date(ts).toLocaleString() : "â€”";
}

let tasks = loadTasks();

function render() {
  const el = document.getElementById("tasks");
  el.innerHTML = "";

  tasks.forEach(task => {
    el.innerHTML += `
      <div class="task">
        <b>${task.name}</b><br>
        ${task.address}<br>
        Status: <span class="status">${task.status}</span><br>
        ğŸ“¸ Captured: ${format(task.capturedAt)}<br>
        â˜ï¸ Uploaded: ${format(task.uploadedAt)}<br>

        <textarea placeholder="Remarks..."
          ${task.status === "DONE" ? "disabled" : ""}
          oninput="updateRemarks('${task.id}', this.value)"
        >${task.remarks}</textarea>

        <button ${task.status !== "PENDING" ? "disabled" : ""}
          onclick="capture('${task.id}')">
          ğŸ“· Upload Picture
        </button>
      </div>
    `;
  });
}

// ================= ACTIONS =================
function updateRemarks(id, value) {
  const t = tasks.find(x => x.id === id);
  t.remarks = value;
  saveTasks();
}

function capture(id) {
  const t = tasks.find(x => x.id === id);
  t.status = "DONE";
  t.capturedAt = Date.now();
  t.uploadedAt = Date.now();
  saveTasks();
  render();
}

// ================= START =================
render();
</script>

</body>
</html>
